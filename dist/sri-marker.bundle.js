(()=>{const e=e=>document.querySelector(e),t=e=>Array.from(document.querySelectorAll(e));function n(e){const t=e instanceof ArrayBuffer?new Uint8Array(e):e;let n="";for(let e=0;e<t.length;e+=32768)n+=String.fromCharCode.apply(null,t.subarray(e,e+32768));return btoa(n)}async function a(e,t){const n=e instanceof ArrayBuffer?e:e.buffer,a=await crypto.subtle.digest(t,n);return new Uint8Array(a)}function r(e){if(0===e)return"0 B";const t=Math.floor(Math.log(e)/Math.log(1024));return(e/Math.pow(1024,t)).toFixed(2)+" "+["B","KB","MB","GB","TB"][t]}function o(e){e.classList.remove("is-hidden")}function s(e){e.classList.add("is-hidden")}async function i(e){const t=document.querySelector(e);let n="";if(t){n="PRE"===t.tagName?t.textContent:t.value||t.textContent;try{await navigator.clipboard.writeText(n),c("Copied to clipboard")}catch{c("Copy failed — select and copy manually","is-danger")}}}function c(e,t="is-success"){const n=document.createElement("div");n.className=`notification ${t}`,n.style.position="fixed",n.style.right="1rem",n.style.bottom="1rem",n.style.zIndex=50,n.innerHTML=`<button class="delete"></button>${e}`,document.body.appendChild(n),n.querySelector(".delete").onclick=()=>n.remove(),setTimeout(()=>n.remove(),2e3)}const l={"tab-url":e("#tab-url"),"tab-file":e("#tab-file"),"tab-paste":e("#tab-paste")};t(".tabs li").forEach(e=>{e.addEventListener("click",()=>{t(".tabs li").forEach(e=>e.classList.remove("is-active")),e.classList.add("is-active"),Object.values(l).forEach(s),o(l[e.dataset.tab])})});const d=e("#dropZone"),u=e("#fileInput"),f=e("#fileName");function y(e){u.files=(new DataTransfer).files;const t=new DataTransfer;t.items.add(e),u.files=t.files,f.textContent=e.name+" ("+r(e.size)+")"}async function p(){const t=document.querySelector(".tabs li.is-active")?.dataset.tab;if("tab-url"===t){const t=e("#urlInput").value.trim();if(!t)throw new Error("Please enter a URL.");let n;try{n=await fetch(t,{credentials:"omit",cache:"no-store"})}catch(e){throw new Error("Network error. If this is a third-party domain, CORS may block the request.")}if(!n.ok)throw new Error("Failed to fetch URL (HTTP "+n.status+").");const a=await n.arrayBuffer();return e("#embedUrl").value||(e("#embedUrl").value=t),{bytes:new Uint8Array(a),label:t,size:a.byteLength}}if("tab-file"===t){const e=u.files?.[0];if(!e)throw new Error("Please choose a file.");const t=await e.arrayBuffer();return{bytes:new Uint8Array(t),label:e.name,size:e.size}}if("tab-paste"===t){const t=e("#codeInput").value;if(!t)throw new Error("Please paste some code.");const a=(n=t,(new TextEncoder).encode(n));return{bytes:a,label:"pasted-source.txt",size:a.byteLength}}var n;throw new Error("No source selected.")}["dragenter","dragover"].forEach(e=>d.addEventListener(e,e=>{e.preventDefault(),d.classList.add("is-dragover")})),["dragleave","drop"].forEach(e=>d.addEventListener(e,e=>{e.preventDefault(),d.classList.remove("is-dragover")})),d.addEventListener("drop",e=>{const t=e.dataTransfer.files?.[0];t&&y(t)}),u.addEventListener("change",()=>{const e=u.files?.[0];e&&y(e)});const b=t(".algo"),v=e("#resultsBox"),h=e("#hashRows"),m=e("#fileMeta"),g=e("#combinedIntegrity");function w(){const t=e("#embedUrl").value.trim();if(!t)return void c("Provide a URL to build embed","is-danger");const n=g.value.trim();if(!n)return void c("Generate integrity first","is-danger");let a="";a="script"===e("#embedType").value?`<script src="${t}" integrity="${n}" crossorigin="anonymous"><\/script>`:`<link rel="stylesheet" href="${t}" integrity="${n}" crossorigin="anonymous">`,e("#embedCode").textContent=a,o(e("#embedBox"))}const L=e("#verifyModal");function E(e){return e.replace(/[&<>"']/g,e=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"}[e]))}e("#verifyBtn").addEventListener("click",()=>{e("#verifyInput").value="",e("#verifyOutput").innerHTML="",L.classList.add("is-active")}),e("#verifyClose").onclick=e("#verifyCancel").onclick=()=>L.classList.remove("is-active"),e("#runVerifyBtn").addEventListener("click",async()=>{let t;try{t=await p()}catch(e){return void c(e.message,"is-danger")}const r=e("#verifyInput").value.trim().split(/\s+/).filter(Boolean);if(0===r.length)return void c("Paste at least one integrity token","is-danger");const o=[];for(const e of r){const r=e.match(/^(sha(256|384|512))-([A-Za-z0-9+/=]+)$/);if(!r){o.push(`<li>❌ Invalid token: <code>${E(e)}</code></li>`);continue}const s="SHA-"+r[2],i=r[3]===n(await a(t.bytes,s));o.push(`<li>${i?"✅":"❌"} <strong>${r[1]}</strong> — ${i?"MATCH":"MISMATCH"}</li>`)}e("#verifyOutput").innerHTML=`<ul>${o.join("")}</ul>`}),e("#generateBtn").addEventListener("click",async function(){const t=b.filter(e=>e.checked).map(e=>e.value);if(0===t.length)return void c("Select at least one algorithm","is-danger");let s;try{s=await p()}catch(e){return void c(e.message,"is-danger")}h.innerHTML="";const i=[];m.innerHTML=`<strong>Source:</strong> <code>${E(s.label)}</code> &nbsp;•&nbsp; <strong>Size:</strong> ${r(s.size)}`;for(const e of t){const t=n(await a(s.bytes,e)),r=e.replace("SHA-","sha"),o=`${r}-${t}`;i.push(o);const c=document.createElement("tr");c.innerHTML=`\n        <td class="nowrap"><span class="tag is-info is-light">${r}</span></td>\n        <td class="hash-block"><code>${t}</code></td>\n        <td class="hash-block"><code>${o}</code></td>\n        <td class="nowrap">\n          <button class="button is-small" data-copy-b64="${t}"><span class="icon"><i class="ti ti-copy"></i></span><span>Copy b64</span></button>\n          <button class="button is-small is-link" data-copy-integrity="${o}"><span class="icon"><i class="ti ti-copy"></i></span><span>Copy SRI</span></button>\n        </td>`,h.appendChild(c)}g.value=i.join(" "),o(v),e("#embedUrl").value.trim()&&w(),h.querySelectorAll("button[data-copy-b64]").forEach(e=>{e.onclick=()=>navigator.clipboard.writeText(e.dataset.copyB64).then(()=>c("Copied Base64"))}),h.querySelectorAll("button[data-copy-integrity]").forEach(e=>{e.onclick=()=>navigator.clipboard.writeText(e.dataset.copyIntegrity).then(()=>c("Copied Integrity"))})}),e("#buildEmbedBtn").addEventListener("click",w),e("#clearBtn").addEventListener("click",()=>{e("#urlInput").value="",u.value="",f.textContent="No file selected",e("#codeInput").value="",e("#embedUrl").value="",h.innerHTML="",e("#embedCode").textContent="",g.value="",s(e("#embedBox")),s(v)}),document.body.addEventListener("click",e=>{const t=e.target.closest("[data-copy]");t&&i(t.getAttribute("data-copy"))}),e("#fetchBtn").addEventListener("click",async()=>{const t=e("#urlInput").value.trim();if(t)try{const n=await fetch(t,{credentials:"omit",cache:"no-store"});if(!n.ok)throw new Error("HTTP "+n.status);c("Fetched "+r((await n.arrayBuffer()).byteLength)),e("#embedUrl").value=t}catch(e){c("Fetch failed (CORS or network). You can download and use Upload/Paste.","is-warning")}else c("Enter a URL first","is-danger")}),t("#resultsBox [data-copy]").forEach(e=>e.addEventListener("click",()=>i(e.getAttribute("data-copy"))))})();